plugins {
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.1.0'
    id 'distribution'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'com.nimbusds:nimbus-jose-jwt:9.31'
    implementation 'org.json:json:20230618'
    
}

javafx {
    version = "21.0.1"
    modules = [ 'javafx.controls', 'javafx.fxml' ]
}

application {
    mainClass = 'MainPage'
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

// Configure distribution
distributions {
    main {
        contents {
            duplicatesStrategy = DuplicatesStrategy.EXCLUDE 
            from(jar) // your main JAR
            into('lib') {
                from(configurations.runtimeClasspath) // all dependencies including JavaFX
                from('/path/to/javafx-sdk-21.0.1/lib')
            }
        }
    }
}

// Create start script that sets up JavaFX properly
startScripts {
    applicationName = 'search-app'
    defaultJvmOpts = [
        '--module-path', "lib/javafx-base-21.0.1-mac.jar:lib/javafx-controls-21.0.1-mac.jar:lib/javafx-fxml-21.0.1-mac.jar:lib/javafx-graphics-21.0.1-mac.jar",
        '--add-modules', 'javafx.controls,javafx.fxml'
    ]
}

jar {
    manifest {
        attributes(
            'Main-Class': 'EntryPoint',
            'Add-Opens': 'javafx.graphics/javafx.scene=ALL-UNNAMED'
        )
    }
    from {
        configurations.runtimeClasspath.collect { 
            it.isDirectory() ? it : zipTree(it) }
    }
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}